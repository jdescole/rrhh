<style type="text/css">
      
      .componenteCambioDomicilio 
      {
          padding-left: 15px;
      }
      
      .fieldsetCambioDomicilio 
      {
            background-color: rgba(218, 218, 218, 0.31);
            border-radius: 15px;
            padding: 10px;
      }
        
    </style>

<div>
    <h2 style="text-align:center">Cambio Domicilio</h2>
    <br />
    <h4>Solicitado por: <span id="nombreUsuario"></span> el día <span id="fechaCreacion"></span> </h4>

    <fieldset class="fieldsetCambioDomicilio">

    <p class="componenteCambioDomicilio">Dirección:  <strong id="calle"></strong>. N° <strong id="numero"></strong>. Piso: <strong id="piso"></strong> Depto:<strong id="depto"></strong></p>
    <!--<p class="componenteCambioDomicilio">Piso: <strong id="piso"></strong> Depto:<strong id="depto"></strong></p>-->
     <p class="componenteCambioDomicilio">Localidad: <strong id="localidad"></strong> - Partido: <strong id="partido"></strong> - Provincia: <strong id="provincia"></strong></p>
     <!--<p class="componenteCambioDomicilio">Provincia: <strong id="provincia"></strong></p>-->
     <p class="componenteCambioDomicilio">Manzana: <strong id="manzana"></strong>. Casa: <strong id="casa"></strong>. Barrio: <strong id="barrio"></strong>. Torre: <strong id="torre"></strong>. UF: <strong id="uf"></strong> </p>
     <p style="display:none;" class="componenteCambioDomicilio">Folio: <input style="height: 30px; width: 120px; " type="text" placeholder="N° Folio" value="0" id="folio" /></p>
     <p class="componenteCambioDomicilio">Id. Doc. Electronico: <strong style="height: 30px; width: 120px;" id="idDocumentoGDE"></strong>. 
                                            N° Informe GDE: <input style="height: 30px; width: 250px;" type="text" placeholder="N° Informe" value="0" id="numeroGDE" />
     </p>



    </fieldset>


     <div style="position: absolute; bottom: 5px; right: 10px;">
        <input type="button" class="btn btn-primary" id="btnConfirmarDomicilio" value="Confirmar" />
        <input type="button" class="btn btn-primary" id="btnActualizarNumeroGDE" value="Actualizar N° GDE" />
        <input type="button" class="btn btn-error" id="btnRechazarCambioDomicilio" value="Rechazar" />
        <input type="button" class="btn" id="btnCancelarDomicilio" value="Volver" />
    <!--    <input type="button" class="btn btn-primary" id="btnDelegarDomicilio" value="Delegar" />-->
    </div>


</div>

<script type="text/javascript">
    var Componente = {
        start: function (ticket, ui) {

            var idTicket = ticket.id;
            var documento = ticket.usuarioCreador.Owner.Documento;
            var idUsuarioCreador = ticket.usuarioCreador.Id;
            var folio = ui.find('#folio').val();

            ui.find('#btnConfirmarDomicilio').click(function () {
                /*if (folio == 0) {
                    alert('Debe ingresar un N° Folio');
                    return;
                }*/
                Backend.VerificarDomicilioPendiente(idTicket, documento, folio, idUsuarioCreador)
                .onSuccess(function (resultado) {
                    alertify.success(resultado);
                    vex.close();

                }).onError(function () {
                    alertify.error("Ha ocurrido un error. Por favor comuniquese con RRHH")
                });
            });

            ui.find('#btnActualizarNumeroGDE').click(function () {
                if (ui.find('#numeroGDE').val() == '') {
                    alert('Debe ingresar un N° de INFORME');
                    return;
                }


                var numeroGDE = ui.find('#numeroGDE').val();
                var idDocumentoGDE = ui.find('#idDocumentoGDE').html();

                Backend.ActualizarNumeroGDEDomicilioPendiente(numeroGDE, idDocumentoGDE)
                    .onSuccess(function (respuesta) {

                    alertify.success("Numero Informe GDE Actualizado.");
                    //vex.dialog.alert('Solicitud de cambio de domicilio generada. Presente el formulario impreso a RRHH');
                    vex.close();
                    


                })
                .onError(function (e) {

                });
            });

            ui.find('#btnRechazarCambioDomicilio').click(function () {
                alertify.prompt('INGRESAR MOTIVO RECHAZO', 'Ingrese un motivo de rechazo', 'Por ',
                        function (evt, value) {
                            if (value == '') {
                                alert('Debe completar un motivo');
                                return;
                            }


                            var motivo = value;
                           
                            Backend.RechazarCambioDomicilio(idTicket, motivo, idUsuarioCreador)
                                .onSuccess(function (resultado) {
                                    alertify.success(resultado);
                                    vex.close();

                                }).onError(function () {
                                    alertify.error("Ha ocurrido un error. Por favor comuniquese con RRHH")
                                });
                        },
                        function () {
                            alertify.error('Cancelado')
                        });


               
            });

            ui.find('#btnCancelarDomicilio').click(function () {
                vex.close();
            });

            ui.find('#btnDelegarDomicilio').click(function () {
                alert('Ha desarrollar');
            });

            Backend.GetDomicilioPendientePorAlerta(idTicket)
                .onSuccess(function (domicilioJSON) {

                    ui.find('#nombreUsuario').html(ticket.usuarioCreador.Owner.Apellido + ', ' + ticket.usuarioCreador.Owner.Nombre);
                    ui.find('#fechaCreacion').html(ConversorDeFechas.deIsoAFechaEnCriollo(ticket.fechaCreacion));

                    var domicilio = $.parseJSON(domicilioJSON);
                    //alert(detalleTareaJSON);
                    ui.find('#calle').html(domicilio.Calle);
                    ui.find('#numero').html(domicilio.Numero);
                    ui.find('#piso').html(domicilio.Piso);
                    ui.find('#depto').html(domicilio.Depto);
                    ui.find('#localidad').html(domicilio.NombreLocalidad);
                    ui.find('#provincia').html(domicilio.NombreProvincia);
                    ui.find('#partido').html(domicilio.NombrePartido);

                    ui.find('#manzana').html(domicilio.Manzana);
                    ui.find('#casa').html(domicilio.Casa);
                    ui.find('#torre').html(domicilio.Torre);
                    ui.find('#barrio').html(domicilio.Barrio);
                    ui.find('#uf').html(domicilio.Uf);
                    ui.find('#idDocumentoGDE').html(domicilio.DocumentoGDE.idDocumentoGDE);
                    ui.find('#numeroGDE').val(domicilio.DocumentoGDE.numero); 

                });
        }
    };

</script>