<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link id="link1" rel="stylesheet" href="../Scripts/imgareaselect/imgareaselect-animated.css" type="text/css" />
    <style type="text/css">
        #pantalla_impresion_credencial
        {
        }      
    </style>
</head>
<div id="pantalla_impresion_credencial">
    <label>Credencial de acceso</label>

    <div id="vista_previa_credencial">
        <img id="imagen_credencial" src="../BarraMenu/credencial.png"/>
        <div id="foto_usuario"></div>
        <div id="apellido"></div>    
        <div id="nombres"></div>    
    </div>

    <div id="organismo_solicitud"></div>
    <div id="motivo_solicitud"></div>

    <input id="btn_imprimir_credencial" type="button" class="btn btn-primary" value="Aprobar"/>
</div>
<script type="text/javascript">
    var Componente = {
        start: function (ticket, ui) {
            Backend.GetSolicitudDeCredencialPorIdTicketImpresion(ticket.id).onSuccess(function (solicitud) {
                Backend.GetUsuarioPorIdPersona(solicitud.IdPersona).onSuccess(function (usuario) {
                    ui.find("#nombre_solicitante").text(usuario.Owner.Nombre);
                    ui.find("#apellido_solicitante").text(usuario.Owner.Apellido);
                    ui.find("#dni_solicitante").text(usuario.Owner.Documento);
                    ui.find("#organismo_solicitud").text(solicitud.Organismo);
                    ui.find("#motivo_solicitud").text(solicitud.Motivo);
                });
                ui.find("#btn_aprobar_solicitud").click(function () {
                    Backend.AprobarSolicitudCredencial(solicitud).onSuccess(function () {
                        alertify.success("Solicitud aprobada con éxito");
                        vex.close();
                        GestionDeTareas.getTareasParaGestion();
                    });
                });
                ui.find("#btn_rechazar_solicitud").click(function () {
                    vex.dialog.prompt({
                        message: 'Indique razón de rechazo',
                        placeholder: '',
                        callback: function (value) {
                            if (value) {
                                Backend.RechazarSolicitudCredencial(solicitud, value).onSuccess(function () {
                                    alertify.success("Solicitud rechazada con éxito");
                                    vex.close();
                                    GestionDeTareas.getTareasParaGestion();
                                });
                            }
                        }
                    })
                    
                });
            });
        }
    };
</script>
